# ðŸ“˜ Complete Node.js Setup Guide - Deep Explanation

## Table of Contents
1. What is Node.js?
2. Why We Need Node.js
3. Installation Steps (All Operating Systems)
4. Understanding npm (Node Package Manager)
5. Creating Your Project
6. Installing Dependencies
7. Understanding package.json
8. Running Your Server
9. Common Issues & Solutions
10. Advanced Configuration

---

## 1ï¸âƒ£ What is Node.js?

### Simple Explanation:
**Node.js** is like a translator that lets you run JavaScript code on your computer (not just in web browsers).

### Technical Explanation:
- **Programming Language**: Uses JavaScript
- **Runtime Environment**: Runs JavaScript outside browsers
- **Built on**: Chrome's V8 JavaScript engine
- **Purpose**: Create servers, APIs, command-line tools
- **Used for**: Backend development, automation, real-time applications

### In Our Project:
Node.js acts as the **bridge** between:
```
Web Application â†â†’ Node.js Server â†â†’ Arduino UNO
```

The Node.js server:
- Receives commands from web app (HTTP)
- Sends commands to Arduino (Serial USB)
- Plays audio files from computer
- Manages the communication

---

## 2ï¸âƒ£ Why We Need Node.js

### Without Node.js:
âŒ Web app can't talk to Arduino directly
âŒ No way to play audio from computer
âŒ No serial port communication
âŒ Can't create HTTP server

### With Node.js:
âœ… Creates HTTP server (port 3000)
âœ… Opens serial port to Arduino
âœ… Plays MP3 files on command
âœ… Bridges web app â†” Arduino

### Our Architecture:
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   Web Application   â”‚ (Browser - JavaScript)
â”‚   (Vercel/Cloud)    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
           â”‚ HTTP Requests
           â”‚ (Can't access USB)
           â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   Node.js Server    â”‚ â† YOU NEED THIS!
â”‚   (Your Computer)   â”‚
â”‚   - Express (HTTP)  â”‚
â”‚   - SerialPort (USB)â”‚
â”‚   - play-sound (MP3)â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
           â”‚ Serial Commands
           â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   Arduino UNO       â”‚ (Hardware)
â”‚   (USB Connected)   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## 3ï¸âƒ£ Installation Steps

### ðŸªŸ Windows Installation

#### Step 1: Download Node.js
1. Open browser
2. Go to: **https://nodejs.org**
3. You'll see two versions:
   - **LTS (Recommended)**: Long Term Support - Stable
   - **Current**: Latest features - May have bugs
4. Click **LTS version** (e.g., "18.17.0 LTS")
5. Download will start (e.g., `node-v18.17.0-x64.msi`)

#### Step 2: Run Installer
1. Double-click downloaded file
2. Click **Next**
3. Accept License Agreement â†’ **Next**
4. Installation Location: `C:\Program Files\nodejs\` â†’ **Next**
5. Custom Setup: Leave defaults â†’ **Next**
6. Tools for Native Modules: âœ… Check this box â†’ **Next**
7. Click **Install**
8. Wait for installation (~2 minutes)
9. Click **Finish**

#### Step 3: Verify Installation
1. Press `Windows Key + R`
2. Type: `cmd` â†’ Press Enter
3. Type: `node --version`
4. Should show: `v18.17.0` (or similar)
5. Type: `npm --version`
6. Should show: `9.6.7` (or similar)

âœ… **Success!** Node.js is installed.

---

### ðŸŽ macOS Installation

#### Step 1: Download Node.js
1. Go to: **https://nodejs.org**
2. Download **LTS version**
3. File will be: `node-v18.17.0.pkg`

#### Step 2: Install
1. Double-click downloaded `.pkg` file
2. Click **Continue**
3. Accept License â†’ **Continue**
4. Select installation location â†’ **Continue**
5. Click **Install**
6. Enter Mac password if prompted
7. Wait for installation
8. Click **Close**

#### Step 3: Verify
1. Open **Terminal** (Cmd + Space, type "Terminal")
2. Type: `node --version`
3. Should show: `v18.17.0`
4. Type: `npm --version`
5. Should show: `9.6.7`

âœ… **Success!** Node.js is installed.

---

### ðŸ§ Linux Installation (Ubuntu/Debian)

#### Method 1: Package Manager (Recommended)

```bash
# Update package list
sudo apt update

# Install Node.js and npm
sudo apt install nodejs npm

# Verify installation
node --version
npm --version
```

#### Method 2: NodeSource Repository (Latest Version)

```bash
# Add NodeSource repository
curl -fsSL https://deb.nodesource.com/setup_18.x | sudo -E bash -

# Install Node.js
sudo apt-get install -y nodejs

# Verify
node --version
npm --version
```

âœ… **Success!** Node.js is installed.

---

## 4ï¸âƒ£ Understanding npm (Node Package Manager)

### What is npm?

**npm** = **N**ode **P**ackage **M**anager

Think of it like:
- **App Store** for Node.js code
- **Library** of reusable code packages
- **Tool** to install and manage packages

### Key Concepts:

#### Package:
A piece of reusable code written by someone else.

**Example:** Instead of writing code to:
- Connect to serial ports â†’ Use `serialport` package
- Create web server â†’ Use `express` package
- Play audio files â†’ Use `play-sound` package

#### Why Use Packages?
- âœ… Don't reinvent the wheel
- âœ… Save time (hours/days of work)
- âœ… Well-tested code
- âœ… Community maintained

### npm Commands You'll Use:

```bash
# Initialize a new project
npm init

# Install a package
npm install express

# Install all packages from package.json
npm install

# Uninstall a package
npm uninstall express

# Check npm version
npm --version

# List installed packages
npm list
```

---

## 5ï¸âƒ£ Creating Your Project

### Step-by-Step Setup:

#### Windows:

```cmd
# Open Command Prompt (Win + R, type cmd)

# Navigate to where you want your project
cd Desktop

# Create project folder
mkdir manikin-system
cd manikin-system

# Create necessary folders
mkdir audio
mkdir audio\respiratory
mkdir audio\cardiac

# List contents to verify
dir
```

#### Mac/Linux:

```bash
# Open Terminal

# Navigate to where you want your project
cd ~/Desktop

# Create project folder
mkdir manikin-system
cd manikin-system

# Create necessary folders
mkdir -p audio/respiratory
mkdir -p audio/cardiac

# List contents to verify
ls -la
```

### What You Created:
```
manikin-system/          â† Your project folder
â”œâ”€â”€ audio/               â† Audio files will go here
â”‚   â”œâ”€â”€ respiratory/     â† Respiratory sounds
â”‚   â””â”€â”€ cardiac/         â† Cardiac sounds
â””â”€â”€ (server files will be added here)
```

---

## 6ï¸âƒ£ Installing Dependencies

### Step 1: Initialize Project

```bash
# You should be in: manikin-system/
npm init -y
```

**What this does:**
- Creates `package.json` file
- `-y` flag = answer "yes" to all questions (use defaults)

**You'll see:**
```
Wrote to /path/to/manikin-system/package.json:
{
  "name": "manikin-system",
  "version": "1.0.0",
  "description": "",
  "main": "index.js",
  "scripts": {
    "test": "echo \"Error: no test specified\" && exit 1"
  },
  "keywords": [],
  "author": "",
  "license": "ISC"
}
```

### Step 2: Copy Server Files

Copy these files to your `manikin-system/` folder:
1. `arduino-simple-bridge.js` (the server code)
2. `package-simple.json` (rename to `package.json`)

Or manually edit `package.json`:

```json
{
  "name": "manikin-system",
  "version": "2.0.0",
  "description": "Arduino manikin controller with computer audio",
  "main": "arduino-simple-bridge.js",
  "scripts": {
    "start": "node arduino-simple-bridge.js"
  },
  "dependencies": {
    "express": "^4.18.2",
    "serialport": "^12.0.0",
    "@serialport/parser-readline": "^12.0.0",
    "cors": "^2.8.5",
    "play-sound": "^1.1.6"
  }
}
```

### Step 3: Install All Packages

```bash
npm install
```

**What happens:**
```
1. npm reads package.json
2. Sees "dependencies" section
3. Downloads each package from npmjs.com
4. Installs to node_modules/ folder
5. Creates package-lock.json
```

**You'll see output like:**
```
npm WARN deprecated ...
npm WARN deprecated ...

added 234 packages, and audited 235 packages in 45s

23 packages are looking for funding
  run `npm fund` for details

found 0 vulnerabilities
```

**What got installed:**

1. **express** (Web server framework)
   - Purpose: Creates HTTP server on port 3000
   - Size: ~200KB + dependencies
   - Used for: API endpoints (/play, /stop, /info, etc.)

2. **serialport** (Serial communication)
   - Purpose: Talk to Arduino via USB
   - Size: ~5MB
   - Used for: Send/receive commands to Arduino

3. **@serialport/parser-readline** (Serial parser)
   - Purpose: Parse serial data line by line
   - Size: ~50KB
   - Used for: Read Arduino responses

4. **cors** (Cross-Origin Resource Sharing)
   - Purpose: Allow web app to access server
   - Size: ~20KB
   - Used for: Enable requests from Vercel/cloud

5. **play-sound** (Audio player)
   - Purpose: Play MP3 files
   - Size: ~10KB
   - Used for: Play medical sounds from computer

### Your Folder Now Looks Like:

```
manikin-system/
â”œâ”€â”€ node_modules/           â† 234 packages installed here!
â”‚   â”œâ”€â”€ express/
â”‚   â”œâ”€â”€ serialport/
â”‚   â”œâ”€â”€ play-sound/
â”‚   â””â”€â”€ ... (231 more packages)
â”œâ”€â”€ audio/
â”‚   â”œâ”€â”€ respiratory/
â”‚   â””â”€â”€ cardiac/
â”œâ”€â”€ arduino-simple-bridge.js  â† Your server code
â”œâ”€â”€ package.json              â† Package configuration
â””â”€â”€ package-lock.json         â† Exact versions installed
```

**Size:**
- `node_modules/`: ~50-100 MB
- Don't worry! This is normal

---

## 7ï¸âƒ£ Understanding package.json

### Anatomy of package.json:

```json
{
  // Project Information
  "name": "manikin-system",           // Project name
  "version": "2.0.0",                  // Version number
  "description": "Arduino manikin...", // What it does
  
  // Entry Point
  "main": "arduino-simple-bridge.js",  // Main file
  
  // Scripts (shortcuts)
  "scripts": {
    "start": "node arduino-simple-bridge.js"  // Run with: npm start
  },
  
  // Required Packages
  "dependencies": {
    "express": "^4.18.2",        // Web server
    "serialport": "^12.0.0",     // Arduino communication
    "cors": "^2.8.5",            // CORS support
    "play-sound": "^1.1.6"       // Audio playback
  }
}
```

### Version Numbers Explained:

```
"express": "^4.18.2"
            â”‚ â”‚  â”‚
            â”‚ â”‚  â””â”€ Patch (bug fixes)
            â”‚ â””â”€â”€â”€â”€ Minor (new features, backward compatible)
            â””â”€â”€â”€â”€â”€ Major (breaking changes)

^ = Allow updates to minor and patch
~ = Allow updates to patch only
(no symbol) = Exact version only
```

**Examples:**
- `^4.18.2` â†’ Can install 4.18.3, 4.19.0, but NOT 5.0.0
- `~4.18.2` â†’ Can install 4.18.3, but NOT 4.19.0
- `4.18.2` â†’ ONLY install 4.18.2

### Common npm Scripts:

```json
"scripts": {
  "start": "node arduino-simple-bridge.js",    // npm start
  "dev": "nodemon arduino-simple-bridge.js",   // npm run dev
  "test": "jest",                               // npm test
}
```

Run with:
- `npm start` (special - no "run" needed)
- `npm run dev`
- `npm test` (special - no "run" needed)

---

## 8ï¸âƒ£ Running Your Server

### Method 1: Direct Node Command

```bash
# Navigate to project folder
cd manikin-system

# Run server directly
node arduino-simple-bridge.js
```

### Method 2: Using npm start

```bash
# Navigate to project folder
cd manikin-system

# Run via npm script
npm start
```

### Method 3: With Port Specified

```bash
# Specify Arduino COM port
node arduino-simple-bridge.js COM3        # Windows
node arduino-simple-bridge.js /dev/ttyACM0  # Linux
node arduino-simple-bridge.js /dev/cu.usbmodem14101  # Mac
```

### Expected Output:

```
=================================
Arduino Simple Bridge Server
(No DFPlayer Required!)
=================================

Checking audio directory...
âœ“ Created ./audio/ directory
âœ“ Created ./audio/respiratory/ directory
âœ“ Created ./audio/cardiac/ directory

âš ï¸  No audio files found!
Please add MP3 files to:
  ./audio/respiratory/normal.mp3
  ./audio/respiratory/crackles.mp3
  ./audio/cardiac/normal.mp3
  etc.

Scanning for Arduino...
Available ports:
  COM3 - Arduino (www.arduino.cc)

Connecting to Arduino on COM3...
âœ“ Serial port opened
Arduino: =================================
Arduino: Physical Examination Manikin
Arduino: Arduino UNO Simple Controller
Arduino: No DFPlayer Required!
Arduino: =================================

Arduino: DEVICE:Simple
Arduino: AUDIO:Computer
Arduino: READY
âœ“ Arduino is ready!

âœ“ Arduino connection established

=================================
âœ“ Server running on port 3000
âœ“ Access at: http://localhost:3000
=================================

âœ¨ Audio plays from COMPUTER speakers!
No DFPlayer Mini needed.

Ready for connections from web application!
Press Ctrl+C to stop server
```

### Server is Now Running!

Test it:
1. Open browser
2. Go to: **http://localhost:3000**
3. Should see web interface
4. Status should show: **Online âœ“**

### Stop Server:

Press: `Ctrl + C` in terminal

---

## 9ï¸âƒ£ Common Issues & Solutions

### Issue 1: "node: command not found"

**Problem:** Node.js not installed or not in PATH

**Solution:**

**Windows:**
```cmd
# Check if installed
where node

# If not found:
# 1. Reinstall Node.js
# 2. During install, check "Add to PATH"
# 3. Restart Command Prompt
```

**Mac/Linux:**
```bash
# Check if installed
which node

# If not found:
# Reinstall Node.js or add to PATH:
export PATH="/usr/local/bin:$PATH"
```

---

### Issue 2: "npm: command not found"

**Problem:** npm not installed with Node.js

**Solution:**

```bash
# npm should come with Node.js
# If missing, reinstall Node.js

# Or install npm separately (Linux):
sudo apt install npm
```

---

### Issue 3: "EACCES: permission denied"

**Problem:** No permission to install packages (Mac/Linux)

**Solution:**

```bash
# Option 1: Use sudo (not recommended)
sudo npm install

# Option 2: Fix npm permissions (recommended)
mkdir ~/.npm-global
npm config set prefix '~/.npm-global'
echo 'export PATH=~/.npm-global/bin:$PATH' >> ~/.bashrc
source ~/.bashrc
```

---

### Issue 4: "Cannot find module 'express'"

**Problem:** Packages not installed

**Solution:**

```bash
# Install all dependencies
npm install

# Or install specific package
npm install express
```

---

### Issue 5: "Port 3000 already in use"

**Problem:** Another program using port 3000

**Solution:**

**Windows:**
```cmd
# Find what's using port 3000
netstat -ano | findstr :3000

# Kill process (replace PID with actual number)
taskkill /PID 12345 /F

# Or change port in code:
# Edit arduino-simple-bridge.js
# Change: const PORT = 3000;
# To:     const PORT = 3001;
```

**Mac/Linux:**
```bash
# Find what's using port 3000
lsof -i :3000

# Kill process
kill -9 PID

# Or change port in code
```

---

### Issue 6: "Serial port not found"

**Problem:** Arduino not detected

**Solution:**

1. **Check Arduino connected:**
   ```bash
   # Windows
   # Device Manager â†’ Ports (COM & LPT)
   # Should see: Arduino UNO (COM3)
   
   # Mac
   ls /dev/cu.*
   # Should see: /dev/cu.usbmodem14101
   
   # Linux
   ls /dev/tty*
   # Should see: /dev/ttyACM0 or /dev/ttyUSB0
   ```

2. **Install USB drivers:**
   - For clone Arduinos: Install CH340 driver
   - Download from: http://www.wch.cn/downloads/

3. **Specify port manually:**
   ```bash
   node arduino-simple-bridge.js COM3
   ```

---

### Issue 7: "Cannot play audio"

**Problem:** play-sound can't find audio player

**Solution:**

**Windows:**
- Usually works out of box (uses Windows Media Player)

**Mac:**
```bash
# Install afplay (usually pre-installed)
# Or install mpg123
brew install mpg123
```

**Linux:**
```bash
# Install audio player
sudo apt install mpg123
# Or
sudo apt install mplayer
# Or
sudo apt install sox libsox-fmt-mp3
```

---

### Issue 8: "gyp ERR!" during npm install

**Problem:** Native modules need C++ compiler

**Solution:**

**Windows:**
```cmd
# Install windows-build-tools
npm install --global windows-build-tools

# Then try again
npm install
```

**Mac:**
```bash
# Install Xcode Command Line Tools
xcode-select --install

# Then try again
npm install
```

**Linux:**
```bash
# Install build tools
sudo apt install build-essential

# Then try again
npm install
```

---

## ðŸ”Ÿ Advanced Configuration

### Auto-Restart on Code Changes

Install `nodemon` (development tool):

```bash
npm install --save-dev nodemon
```

Update `package.json`:
```json
"scripts": {
  "start": "node arduino-simple-bridge.js",
  "dev": "nodemon arduino-simple-bridge.js"
}
```

Run with auto-restart:
```bash
npm run dev
```

Now server restarts automatically when you edit code!

---

### Environment Variables

Create `.env` file:
```
PORT=3000
ARDUINO_PORT=COM3
AUDIO_DIR=./audio
```

Install `dotenv`:
```bash
npm install dotenv
```

Use in code:
```javascript
require('dotenv').config();

const PORT = process.env.PORT || 3000;
const ARDUINO_PORT = process.env.ARDUINO_PORT;
```

---

### Process Manager (Production)

Install PM2 (keeps server running):

```bash
npm install -g pm2

# Start server
pm2 start arduino-simple-bridge.js --name manikin

# Check status
pm2 status

# View logs
pm2 logs manikin

# Stop
pm2 stop manikin

# Restart
pm2 restart manikin

# Auto-start on boot
pm2 startup
pm2 save
```

---

### Logging

Add logging with `winston`:

```bash
npm install winston
```

Use in code:
```javascript
const winston = require('winston');

const logger = winston.createLogger({
  level: 'info',
  format: winston.format.json(),
  transports: [
    new winston.transports.File({ filename: 'error.log', level: 'error' }),
    new winston.transports.File({ filename: 'combined.log' }),
    new winston.transports.Console()
  ]
});

logger.info('Server started');
logger.error('Error occurred');
```

---

## ðŸ“š Additional Resources

### Official Documentation:
- Node.js: https://nodejs.org/docs
- npm: https://docs.npmjs.com
- Express: https://expressjs.com
- SerialPort: https://serialport.io

### Learn More:
- Node.js Tutorial: https://nodejs.dev/learn
- npm Guide: https://docs.npmjs.com/about-npm
- JavaScript: https://javascript.info

### Get Help:
- Stack Overflow: https://stackoverflow.com/questions/tagged/node.js
- Node.js Discord: https://discord.gg/nodejs
- npm Discord: https://discord.gg/npm

---

## âœ… Summary Checklist

Setup Complete When You Can:

- [ ] Run `node --version` â†’ shows version
- [ ] Run `npm --version` â†’ shows version
- [ ] Navigate to project folder
- [ ] Run `npm install` â†’ installs packages
- [ ] Run `npm start` â†’ starts server
- [ ] See "âœ“ Server running on port 3000"
- [ ] See "âœ“ Arduino is ready!"
- [ ] Open http://localhost:3000 â†’ see web interface
- [ ] Server responds to commands

If ALL checked: âœ… **You're ready!**

---

## ðŸŽ‰ You Now Understand:

âœ… What Node.js is and why we need it
âœ… How to install Node.js on any OS
âœ… What npm is and how it works
âœ… How to create a Node.js project
âœ… How to install dependencies
âœ… What package.json contains
âœ… How to run your server
âœ… How to fix common issues
âœ… Advanced configuration options

**You're now a Node.js user!** ðŸš€

---

**Questions? Check the troubleshooting section or ask for help!**
